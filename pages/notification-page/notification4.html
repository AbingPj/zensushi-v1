<!DOCTYPE html>
<html lang="en">

<head>
    <title>Zen Sushi - RawMaterial Inventory</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="../../img/zenicon.png">
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/open-iconic-master/font/css/open-iconic-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../css/loading.css" />
    <link rel="stylesheet" type="text/css" href="../../css/loading-btn.css" />
    <link rel="stylesheet" type="text/css" href="../../css/animation.css" />

    <link rel="stylesheet" type="text/css" href="../../DataTables/datatables.min.css" />

</head>

<body>
    <div class="panel">


        <!-- header -->
        <div class="jumbotron customjumbotron">
        </div>

        <!-- navbar -->
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <img src="../../img/zenicon3.png" class="rounded float-left">
            <a class="navbar-brand active" href="../../pages/home-page/home.html">Zen Sushi Inventory</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav mr-auto">

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Registry
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="../../pages/create-category-page/create-category.html">Categories</a>
                            <a class="dropdown-item" href="../../pages/create-rawmaterial-page/create-rawmaterial.html">RawMaterials</a>
                            <a class="dropdown-item" href="../../pages/create-products-page/create-product.html">Products</a>
                            <a class="dropdown-item" href="">Accounts</a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            RawMaterials
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="../../pages/inventory-rawmaterials-page/inv-rawmaterials.html">Inventory</a>
                            <a class="dropdown-item" href="../../pages/reports-rawmaterials-page/rp-rawmaterials.html">Reports</a>
                            <a class="dropdown-item" href="../../pages/records-rawmaterials-page/rec-rawmaterials.html">Records</a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Products
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="../../pages/inventory-products-page/inv-products.html">Inventory</a>
                            <a class="dropdown-item" href="../../pages/order-products-page/order-products.html">Order/Request</a>
                            <a class="dropdown-item" href="../../pages/deliver-page/deliver-products.html">Deliver</a>
                            <a class="dropdown-item" href="../../pages/reports-products-page/rp-products.html">Reports</a>
                            <a class="dropdown-item" href="../../pages/records-products-page/rec-products.html">Records</a>
                        </div>
                    </li>
                    <!-- <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Inventory
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="../../pages/inventory-rawmaterials-page/inv-rawmaterials.html">Rawmaterials</a>
                            <a class="dropdown-item" href="../../pages/inventory-products-page/inv-products.html">Products</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Reports
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="../../pages/reports-rawmaterials-page/rp-rawmaterials.html">Rawmaterials</a>
                            <a class="dropdown-item" href="../../pages/reports-products-page/rp-products.html">Products</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Request/Order
                        </a>
                        <div class="dropdown-menu">
                                <a class="dropdown-item" href="../../pages/order-products-page/order-products.html">Products</a>
                            <a class="dropdown-item">Rawmaterials</a>
                        </div>
                    </li> -->
                </ul>


                <ul class="nav navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../pages/notification-page/notification.html">Notifications <span
                                class="oi oi-bell">
                                <big><span class="badge badge-danger" id="notification_badge"></span></big>
                            </span>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            <b id="usernameAtNavabar"> .</b>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="../../index.html" id="LogOut">Log Out</a>
                        </div>
                    </li>
                </ul>

            </div>
        </nav>


        <!--body-->
        <div class="container myMinimumContent myOpacity2">

            <div class="container" style="margin-top:5%; 
                margin-bottom:100px;">
                <div class="row">
                    <div class="col-sm-9 col-md-8 col-lg-8 mx-auto">
                        <br>
                        <h3>Notifications</h3>
                        <br>
                        <div id="orders" class="list-group">
                            <!-- <div class="card">
                                <div class="card-body">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1">Account Name</h5>
                                        <small>2018-01-01 12:00:00</small>
                                    </div>
                                    <p class="mb-1">Request Product</p>
                                    <small><a href=""> view</a></small>
                                </div>
                            </div> -->
                        </div>


                        <div class="ld-over" id="myloader">
                            <div class="ld ld-ring  ld-spin"></div>
                            <br>
                            <br>
                        </div>



                    </div>

                </div>
            </div>
        </div>
        <!-- footer -->
        <div class="jumbotron text-center" style="margin-bottom:0">
            <p>Copyright. All Rights Reserved</p>
        </div>
        <script src="../../js/jquery-3.3.1.min.js"></script>
        <script src="https://js.pusher.com/4.3/pusher.min.js"></script>
        <script src="../../js/zen.js"></script>
        <script src="../../js/zenUpdate.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script src="../../js/bootstrap_notify_3/dist/bootstrap-notify.min.js"></script>
        <script type="text/javascript" src="../../DataTables/datatables.min.js"></script>
</body>

</html>
<script>

    function Notify_inv_object() {
        this.orders;
    };
    const data_obj = new Notify_inv_object();

    var start = 0;
    var working = false;

    $(document).ready(function () {
        if (localStorage.getItem('zen_login') == 'true' && localStorage.getItem('zen_username') != null && localStorage.getItem('zen_userid') != null) {
            requestNotificationUnseenLength();
            var username = localStorage.getItem("zen_username");
            $('#usernameAtNavabar').html(username);
            request_Orders();

        }
        else {
            localStorage.clear();
            sessionStorage.clear();
            window.location = "../../index.html";
        }

    });


    function request_Orders() {
        $('#myloader').addClass("running");
        $.ajax({
            type: "GET",
            url: "http://zensushi-inv.000webhostapp.com/onsen-php-file/Notification-Orders-Display2.php?start=" + start,
            processData: true,
            contentType: "application/json",
            data: '',
            success: function (data) {
                console.log(data);
                var result = $.parseJSON(data);
                data_obj.orders = result;
                display();
                $('#myloader').removeClass("running");
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                console.log('error');
            }
        });
    }

    function display() {
        $.each(data_obj.orders, function (i, value) {
            if (value.seen == 0) {
                var htmlStrings1 = ' <div class="card bg-light"> <div class="card-body"> <div class="d-flex w-100 justify-content-between"> <h5 class="mb-1">';
            } else {
                var htmlStrings1 = ' <div class="card bg-secondary"> <div class="card-body"> <div class="d-flex w-100 justify-content-between"> <h5 class="mb-1">';
            }
            var htmlStrings2 = value.account_name + '</h5><small>';
            var htmlStrings3 = value.created_at + '</small> </div>  <p class="mb-1">Request Products</p>';
            var htmlStrings4 = '<small><button class="btn btn-primary btn-sm btn-viewProd" value="' + value.id + '" id="' + value.id + '"> view</button></small> </div>   </div> <br>';
            $("#orders").append(htmlStrings1 + htmlStrings2 + htmlStrings3 + htmlStrings4);
        });
        start += 5;
        if (start >= 5) {
            setTimeout(function () {
                working = false;
            }, 3000)
        }

    }

    $(window).scroll(function () {
        if ($(this).scrollTop() + 1 >= $('body').height() - $(window).height()) {
            if (working == false) {
                working = true;
                request_Orders();
            }
        }
    })

    $(document).on('click', 'button.btn-viewProd', function () {
        var orderId = $(this).attr('id'); // $(this) refers to button that was clicked
        //sessionStorage.setItem('orderId', id);
        window.open('../../pages/notification-page/request_list.php?orderId=' + orderId, '_blank');
        //window.location = '../../pages/notification-page/request_list.php?orderId=' + orderId;
    })


</script>